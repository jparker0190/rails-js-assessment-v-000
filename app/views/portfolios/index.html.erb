 <div class="container text-center">
  <br>

<!--breadcrumb-->
   <nav aria-label="breadcrumb">
     <ol class="breadcrumb">
       <li class="breadcrumb-item active" aria-current="page">Home</li>
     </ol>
   </nav>
<!--breadcrumb-->

<!--navbar for making portfolio display more elegant-->
<div class="card card-login mx-auto mt-5">
 <div class="row">
  <div class="card-header text-right col-3"></div><!--ending div for the left-->
   <div class="card-header text-center col-6">
    <strong>Current Portfolios</strong>
   </div><!--ending for card-header text-center col-6-->
   <div class="card-header text-right col-3"><%= link_to 'Sign out', destroy_user_session_path, method: :delete%>&nbsp&nbsp
   </div><!--ending div for card-header text-right col-3-->
   
<!--ul list for tab headers-->   
<div class="card-body">
  <div class='form-group'>
   <ul class="nav nav-tabs" id="myTab" role="tablist">
    <% @portfolios.each do |portfolio| %>
      <li class="nav-item">
        <a class="nav-link" id="portfolio-tab" data-toggle="tab" href="#portfolio<%=portfolio.id%>" role="tab" aria-controls="portfolio" aria-selected="true"><%=portfolio.name%></a>
      </li>
    <%end%>
   </ul>
  

<!--div for content inside tab headers-->
 <div class="tab-content" id="myTabContent">
  <% @portfolios.each do |portfolio| %>
    <div class="tab-pane fade" id="portfolio<%=portfolio.id%>" role="tabpanel" aria-labelledby="portfolio-tab">

<!--container div for everything ruby methods inside portfolio tabs-->
    <div class="container">
     <div class="row border-bottom">
        <div class="col">Ticker</div>
        <div class="col">Shares</div>
        <div class="col">Price</div>
        <div class="col">Market Value</div>
      </div>
      
         <% portfolio.assignments.each_with_index do |a, index|%>
            <div class="accordion" id="accordionExample">
              <div>
               <div id="headingThree">
                <p class="mb-0">
                 <button class="<%=a.stock.ticker%>" type="button" data-toggle="collapse" data-target="#collapseThree<%=a.id%>" aria-expanded="false" aria-controls="collapseThree<%=a.id%>"> 
                 </button>
                    <div class="row border-bottom">
                      <div class="col"><%= a.stock.ticker %></div>
                      <div class="col"><%=a.shares%></div>
                      <div class="col">$<%=a.stock.price%>.00</div>
                      <div class="col">$<%=a.stock.price * a.shares%>.00</div>
                    </div>
                 </p>
               </div><!--ending div for headingThree-->

<!--begin section for data inside tickers-->
      <div id="collapseThree<%=a.id%>" class="collapse<%a.id%>" aria-labelledby="headingThree" data-parent="#accordionExample">
        <div class="card-body">

<!--adding the carousel-->
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Data</a>
    </li>
    <li class="nav-item">
     <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Profile</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Contact</a>
    </li>
  </ul>  

<!--begin section for content inside ticker data tabs-->
  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">

<!--script for loading ticker tabs data-->
<script>
  $(".<%=a.stock.ticker%>").on("click", function() {
    var iexstats = "https://api.iextrading.com/1.0/stock/<%=a.stock.ticker.to_s%>/stats";
    var iexquote = "https://api.iextrading.com/1.0/stock/<%=a.stock.ticker.to_s%>/quote"
    $.getJSON(iexquote, function(data) {
       let pricelist = [data.latestPrice, data.previousClose, data.open, data.week52High, data.week52Low, data.marketCap]
       $('.prices').empty();
       $.each(pricelist, function(key, value){
         var html = value+'<br>';
          $('.prices').append(html);
       })
   });
    $.getJSON(iexstats, function(data) {
       let volumelist = [data.institutionPercent, data.insiderPercent, data.day200MovingAvg, data.day50MovingAvg, data.float, data.shortRatio]
       let changelist = [data.latestEPSDate, data.month3ChangePercent, data.month6ChangePercent, data.year1ChangePercent, data.ytdChangePercent, data.day5ChangePercent]
       $('.volumes').empty();
       $.each(volumelist, function(key, value){
         var html = value+'<br>';
          $('.volumes').append(html);
       })
        $('.changes').empty();
       $.each(changelist, function(key, value){
         var html = value+'<br>';
          $('.changes').append(html);
       })
   });
  });
</script>

<!--div rows and columns for holding above jquery-->
   <div class="row border-bottom">
     <div class="col">Current Price:<br>Previous Close:<br>Opening Price:<br>52 Wk High:<br>52 Wk Low:<br>Market Cap:</div>
     <div class="col-sm"><div class="prices"></div></div>
     <div class="col">Last EPS:<br>3 Mth Change:<br>6 Mth Change:<br>1 Yr Change:<br>YTD Change:<br>5 Day Change:</div>
     <div class="col-sm"><div class="changes"></div></div>
     <div class="col">Inst. Owned:<br>Insider Owned:<br>200 Day Avg:<br>50 Day Vol:<br>Float:<br>Short Ratio:<br></div>  
     <div class="col-sm"><div class="volumes"></div></div>
   </div>
      
    </div><!--ending div for tab-pane fade show active-->
    <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">...</div>
    <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">...</div>
  </div><!--ending div for tab-content-->

<!--ending carousel-->
     </div><!--ending div for card-body-->
    </div><!--ending div for collapseThree-->
   </div><!--ending div for empty div-->
  </div><!--ending div for accordion-->
  <%end%>
    </ul>
    </div><!--ending div for container-->
      <%= link_to 'Add stock', new_portfolio_assignment_path(portfolio) %>  |
      <%= link_to 'Edit Portfolio Holdings', assignments_path(portfolio) %>  |
      <%= link_to 'Delete Portfolio', portfolio, method: :delete, data: {confirm: 'Really?'} %><br><br>
    </div><!--ending div for tab-pane fade-->
  <%end%>
    </div><!--ending div for tab-content-->
   </div><!--ending div for form-group-->
  </div><!--ending div for card-body-->
 </div><!--ending div for row-->
</div><!--ending div for card card-login mx-auto mt-5-->

<br>
    <%= link_to 'Create Portfolio', new_portfolio_path, class: 'btn btn-light'%>
    <button onclick="getStocks();" type="button" class="btn btn-light" data-toggle="modal" data-target="#exampleModalCenter">All available Stocks</button>


<!-- Modal for displaying all stocks-->
        <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Stocks</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
                <div class="modal-body">
                  <table class="table table-bordered" id="stockTable" width="100%" cellspacing="0">
                    <thead>
                      <tr>
                        <th>Ticker</th>
                        <th>Price</th>
                       <!-- <th>Functions</th>-->
                      </tr>
                    </thead>
                    <tbody>
                      <div id="moreInfo"><p></p></div>
                    </tbody>
                  </table>
                  
                </div>
                
              <div class="modal-footer">
                <%= link_to 'Create a new Stock', new_stock_path, class: 'btn btn-secondary'%>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>

 <!--Modal for displaying all stocks-->
</div><!--ending div for "container text-center"-->